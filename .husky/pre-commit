# Rodar o PHPStan

echo "Rodando o PHPStan..."
./vendor/bin/phpstan
if [ $? -ne 0 ]; then
    echo "Opa! Deu ruim aqui com o PHPStan. Arrume antes de continuar... ðŸ˜‰"
    exit 1
fi

# Rodar os testes
echo "Rodando os testes..."
php artisan test --parallel
if [ $? -ne 0 ]; then
    echo "Opa! Deu ruim aqui com algum teste. Arrume antes de continuar... ðŸ˜‰"
    exit 1
fi

# Formatar os arquivos alterados usando o Laravel Pint
echo "Formatando arquivos com o Laravel Pint..."

# Captura todos os arquivos PHP modificados para o commit
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep ".php\{0,1\}$") || true

if [ -z "$STAGED_FILES" ]; then
    echo "Nenhum arquivo PHP foi alterado. Nada para formatar!"
else
    for FILE in $STAGED_FILES
    do
        echo "Rodando o Pint para o arquivo: ${FILE}"  # Mensagem para verificar qual arquivo estÃ¡ sendo processado
        ./vendor/bin/pint "${FILE}" > /dev/null 2>&1  # Executa o Pint para o arquivo
        git add "${FILE}";  # Adiciona o arquivo formatado ao commit
    done
fi

echo "Tudo pronto! ðŸš€"

# Finaliza o script com sucesso
exit 0

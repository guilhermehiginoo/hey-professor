# Rodar o PHPStan
echo "ğŸš€ Rodando o PHPStan... Vamos ver se o cÃ³digo estÃ¡ nos conformes!"
./vendor/bin/phpstan
if [ $? -ne 0 ]; then
    echo "ğŸ˜± Opa! Algo deu errado com o PHPStan. Corrige aÃ­ antes de continuar! ğŸ˜‰"
    exit 1
fi

# Rodar os testes
echo "ğŸ§ª Agora Ã© hora de rodar os testes. Vamos ver se tudo estÃ¡ funcionando direitinho..."
php artisan test --parallel
if [ $? -ne 0 ]; then
    echo "ğŸ˜• Algo deu errado nos testes. Arruma aÃ­ e tenta de novo!"
    exit 1
fi

# Formatar os arquivos alterados usando o Laravel Pint
echo "âœ¨ Formatando os arquivos com o Laravel Pint... Deixar tudo alinhado e bonito!"

# Captura todos os arquivos PHP modificados para o commit
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep ".php\{0,1\}$") || true

if [ -z "$STAGED_FILES" ]; then
    echo "ğŸ‘ Nenhum arquivo PHP foi alterado. Tudo certo por aqui!"
else
    for FILE in $STAGED_FILES
    do
        echo "ğŸ“ Rodando o Pint no arquivo: ${FILE}... Deixando ele impecÃ¡vel!"
        ./vendor/bin/pint "${FILE}" > /dev/null 2>&1  # Executa o Pint para o arquivo
        git add "${FILE}";  # Adiciona o arquivo formatado ao commit
        echo "ğŸ‘Œ O arquivo ${FILE} estÃ¡ pronto e bem formatado!"
    done
fi

echo "ğŸ‰ Tudo pronto! Agora seu cÃ³digo estÃ¡ impecÃ¡vel. Pode fazer o push tranquilo!"

# Finaliza o script com sucesso
exit 0
